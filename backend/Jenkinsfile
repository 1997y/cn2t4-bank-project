pipeline {
    agent any

    environment {
        COMPOSE_PROJECT_NAME = 'bank-project'
        DOCKERHUB_CREDENTIALS = credentials('docker-hub-credentials')  // ì˜µì…˜, ë‚˜ì¤‘ì— ì“°ê³  ì‹¶ìœ¼ë©´
        GIT_COMMIT_HASH = ''
    }

    stages {
        stage('Checkout') {
            steps {
                // Checkout the GitHub repository
                checkout scm
            }
        }

        stage('Set Git Commit Hash') {
            steps {
                script {
                    GIT_COMMIT_HASH = sh(script: "git rev-parse --short HEAD", returnStdout: true).trim()
                    echo "Git Commit Hash: ${GIT_COMMIT_HASH}"
                }
            }
        }

        stage('Build and Run with Docker Compose') {
            steps {
                script {
                    sh '''
                        echo "âœ… Docker Compose Build ì‹œì‘"
                        docker-compose down || true
                        docker-compose build
                        docker-compose up -d
                    '''
                }
            }
        }
    }

    post {
        success {
            echo 'ğŸ—ï¸ Docker Compose Build & Up ì„±ê³µ!'
        }
        failure {
            echo 'âŒ Docker Compose ì‹¤íŒ¨'
        }
    }
}